<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CTOR Tournament — Modular Edition</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  table {
    border-collapse: collapse;
    margin-top: 10px;
  }
  td {
    width: 30px;
    height: 30px;
    text-align: center;
    border: 1px solid #999;
    font-size: 20px;
  }
  .R { background: #222; color: white; }
  .B { background: #eee; color: black; }
</style>
</head>

<body>

<h1>CTOR Tournament — Modular Edition</h1>

<div>
  <label>Bot R:</label>
  <select id="botR"></select>

  <label>Bot B:</label>
  <select id="botB"></select>
</div>

<div style="margin-top:10px;">
  <button id="startBtn">Start Match</button>
  <button id="stepBtn">Next Move</button>
  <button id="autoBtn">Auto Play</button>
  <button id="stopBtn">Stop</button>
</div>

<h3>Board</h3>
<div id="boardContainer"></div>

<h3>Upload Custom Bot</h3>
<input type="file" id="botFile" accept=".js">

<h3>Available Bots</h3>
<table id="botTable" border="1" cellpadding="5">
  <thead>
    <tr><th>Name</th><th>Source</th></tr>
  </thead>
  <tbody></tbody>
</table>

<!-- ============================================================
     MODULE IMPORTS
     ============================================================ -->
<script type="module">
  import { Bots, botSources } from "./bots/builtins.js";
  import { setupBotUpload } from "./bots/upload.js";
  import { createBoardTable, updateBoardView } from "./visual/boardView.js";
  import { MatchRunner } from "./tournament/matchRunner.js";

  /* ------------------------------------------------------------
     INITIAL SETUP
     ------------------------------------------------------------ */
  const boardContainer = document.getElementById("boardContainer");
  const table = createBoardTable();
  boardContainer.appendChild(table);

  const botRSelect = document.getElementById("botR");
  const botBSelect = document.getElementById("botB");
  const botTableBody = document.querySelector("#botTable tbody");

  function refreshBotSelectors() {
    botRSelect.innerHTML = "";
    botBSelect.innerHTML = "";
    for (const name in Bots) {
      const opt1 = document.createElement("option");
      opt1.value = name;
      opt1.textContent = name;
      botRSelect.appendChild(opt1);

      const opt2 = document.createElement("option");
      opt2.value = name;
      opt2.textContent = name;
      botBSelect.appendChild(opt2);
    }
  }

  function refreshBotTable() {
    botTableBody.innerHTML = "";
    for (const name in Bots) {
      const tr = document.createElement("tr");
      const td1 = document.createElement("td");
      const td2 = document.createElement("td");
      td1.textContent = name;
      td2.textContent = botSources[name] || "unknown";
      tr.appendChild(td1);
      tr.appendChild(td2);
      botTableBody.appendChild(tr);
    }
  }

  refreshBotSelectors();
  refreshBotTable();

  setupBotUpload(() => {
    refreshBotSelectors();
    refreshBotTable();
  });

  /* ------------------------------------------------------------
     MATCH RUNNER
     ------------------------------------------------------------ */
  let runner = null;

  document.getElementById("startBtn").onclick = () => {
    runner = new MatchRunner(
      Bots,
      botSources,
      botRSelect.value,
      botBSelect.value,
      (board) => updateBoardView(table, board)
    );
    runner.start();
  };

  document.getElementById("stepBtn").onclick = () => {
    if (runner) runner.step();
  };

  document.getElementById("autoBtn").onclick = () => {
    if (runner) runner.autoPlay();
  };

  document.getElementById("stopBtn").onclick = () => {
    if (runner) runner.stop();
  };
</script>

</body>
</html>

